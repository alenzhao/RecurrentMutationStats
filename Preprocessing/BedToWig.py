'''
Created on Mar 9, 2015

@author: cmelton
'''


import os, subprocess

def run(bedfile, outputfile, intfile):
    intermediatefiles={}
    f=open(bedfile, 'r')
    line=f.readline()
    while line[0]=="#": line=f.readline()
    while line!="":
#         print line.strip().split("\t")
        chrom, start, stop, val=line.strip().split("\t")
        if chrom not in intermediatefiles:
#             intermediatefiles[chrom]=open(intfile+"."+chrom.strip("chr")+".wig", "w")
            intermediatefiles[chrom]=open(outputfile[0:-4]+"."+chrom.strip("chr")+".wig", "w")
        else:
            intermediatefiles[chrom].write("\n")
        intermediatefiles[chrom].write("fixedStep chrom="+chrom.strip("chr")+" start="+str(int(start)+1)+" step="+str(int(stop)-int(start)))
        intermediatefiles[chrom].write("\n"+val.split("_")[0])
        line=f.readline()
    for f in intermediatefiles.values(): f.close()
#     f=open(outputfile, 'w')
#     i=0
#     for chrom in ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "X", "Y", "M", "MT"]:
#         if "chr"+chrom in intermediatefiles:
#             if i!=0: f.write("\n")
#             g=open(intfile+"."+chrom+".wig", 'r')
#             data=g.read()
#             g.close()
#             f.write(data)
#             i+=1
#             os.remove(intfile+"_chr"+chrom+".wig")
#     f.close()
            
if __name__ == '__main__':
    #[
#     gzfiles=map(lambda x: "/Users/cmelton/Downloads/all.mnemonics.bedFiles/"+x,["E001_15_coreMarks_mnemonics.bed.gz","E002_15_coreMarks_mnemonics.bed.gz","E003_15_coreMarks_mnemonics.bed.gz","E004_15_coreMarks_mnemonics.bed.gz","E005_15_coreMarks_mnemonics.bed.gz","E006_15_coreMarks_mnemonics.bed.gz","E007_15_coreMarks_mnemonics.bed.gz","E008_15_coreMarks_mnemonics.bed.gz","E009_15_coreMarks_mnemonics.bed.gz","E010_15_coreMarks_mnemonics.bed.gz","E011_15_coreMarks_mnemonics.bed.gz","E012_15_coreMarks_mnemonics.bed.gz","E013_15_coreMarks_mnemonics.bed.gz","E014_15_coreMarks_mnemonics.bed.gz","E015_15_coreMarks_mnemonics.bed.gz","E016_15_coreMarks_mnemonics.bed.gz","E017_15_coreMarks_mnemonics.bed.gz","E018_15_coreMarks_mnemonics.bed.gz","E019_15_coreMarks_mnemonics.bed.gz","E020_15_coreMarks_mnemonics.bed.gz","E021_15_coreMarks_mnemonics.bed.gz","E022_15_coreMarks_mnemonics.bed.gz","E023_15_coreMarks_mnemonics.bed.gz","E024_15_coreMarks_mnemonics.bed.gz","E025_15_coreMarks_mnemonics.bed.gz","E026_15_coreMarks_mnemonics.bed.gz","E027_15_coreMarks_mnemonics.bed.gz","E028_15_coreMarks_mnemonics.bed.gz","E029_15_coreMarks_mnemonics.bed.gz","E030_15_coreMarks_mnemonics.bed.gz","E031_15_coreMarks_mnemonics.bed.gz","E032_15_coreMarks_mnemonics.bed.gz","E033_15_coreMarks_mnemonics.bed.gz","E034_15_coreMarks_mnemonics.bed.gz","E035_15_coreMarks_mnemonics.bed.gz","E036_15_coreMarks_mnemonics.bed.gz","E037_15_coreMarks_mnemonics.bed.gz","E038_15_coreMarks_mnemonics.bed.gz","E039_15_coreMarks_mnemonics.bed.gz","E040_15_coreMarks_mnemonics.bed.gz","E041_15_coreMarks_mnemonics.bed.gz","E042_15_coreMarks_mnemonics.bed.gz","E043_15_coreMarks_mnemonics.bed.gz","E044_15_coreMarks_mnemonics.bed.gz","E045_15_coreMarks_mnemonics.bed.gz","E046_15_coreMarks_mnemonics.bed.gz","E047_15_coreMarks_mnemonics.bed.gz","E048_15_coreMarks_mnemonics.bed.gz","E049_15_coreMarks_mnemonics.bed.gz","E050_15_coreMarks_mnemonics.bed.gz","E051_15_coreMarks_mnemonics.bed.gz","E052_15_coreMarks_mnemonics.bed.gz","E053_15_coreMarks_mnemonics.bed.gz","E054_15_coreMarks_mnemonics.bed.gz","E055_15_coreMarks_mnemonics.bed.gz","E056_15_coreMarks_mnemonics.bed.gz","E057_15_coreMarks_mnemonics.bed.gz","E058_15_coreMarks_mnemonics.bed.gz","E059_15_coreMarks_mnemonics.bed.gz","E061_15_coreMarks_mnemonics.bed.gz","E062_15_coreMarks_mnemonics.bed.gz","E063_15_coreMarks_mnemonics.bed.gz","E065_15_coreMarks_mnemonics.bed.gz","E066_15_coreMarks_mnemonics.bed.gz","E067_15_coreMarks_mnemonics.bed.gz","E068_15_coreMarks_mnemonics.bed.gz","E069_15_coreMarks_mnemonics.bed.gz","E070_15_coreMarks_mnemonics.bed.gz","E071_15_coreMarks_mnemonics.bed.gz","E072_15_coreMarks_mnemonics.bed.gz","E073_15_coreMarks_mnemonics.bed.gz","E074_15_coreMarks_mnemonics.bed.gz","E075_15_coreMarks_mnemonics.bed.gz","E076_15_coreMarks_mnemonics.bed.gz","E077_15_coreMarks_mnemonics.bed.gz","E078_15_coreMarks_mnemonics.bed.gz","E079_15_coreMarks_mnemonics.bed.gz","E080_15_coreMarks_mnemonics.bed.gz","E081_15_coreMarks_mnemonics.bed.gz","E082_15_coreMarks_mnemonics.bed.gz","E083_15_coreMarks_mnemonics.bed.gz","E084_15_coreMarks_mnemonics.bed.gz","E085_15_coreMarks_mnemonics.bed.gz","E086_15_coreMarks_mnemonics.bed.gz","E087_15_coreMarks_mnemonics.bed.gz","E088_15_coreMarks_mnemonics.bed.gz","E089_15_coreMarks_mnemonics.bed.gz","E090_15_coreMarks_mnemonics.bed.gz","E091_15_coreMarks_mnemonics.bed.gz","E092_15_coreMarks_mnemonics.bed.gz","E093_15_coreMarks_mnemonics.bed.gz","E094_15_coreMarks_mnemonics.bed.gz","E095_15_coreMarks_mnemonics.bed.gz","E096_15_coreMarks_mnemonics.bed.gz","E097_15_coreMarks_mnemonics.bed.gz","E098_15_coreMarks_mnemonics.bed.gz","E099_15_coreMarks_mnemonics.bed.gz","E100_15_coreMarks_mnemonics.bed.gz","E101_15_coreMarks_mnemonics.bed.gz","E102_15_coreMarks_mnemonics.bed.gz","E103_15_coreMarks_mnemonics.bed.gz","E104_15_coreMarks_mnemonics.bed.gz","E105_15_coreMarks_mnemonics.bed.gz","E106_15_coreMarks_mnemonics.bed.gz","E107_15_coreMarks_mnemonics.bed.gz","E108_15_coreMarks_mnemonics.bed.gz","E109_15_coreMarks_mnemonics.bed.gz","E110_15_coreMarks_mnemonics.bed.gz","E111_15_coreMarks_mnemonics.bed.gz","E112_15_coreMarks_mnemonics.bed.gz","E113_15_coreMarks_mnemonics.bed.gz","E114_15_coreMarks_mnemonics.bed.gz","E115_15_coreMarks_mnemonics.bed.gz","E116_15_coreMarks_mnemonics.bed.gz","E117_15_coreMarks_mnemonics.bed.gz","E118_15_coreMarks_mnemonics.bed.gz","E119_15_coreMarks_mnemonics.bed.gz","E120_15_coreMarks_mnemonics.bed.gz","E121_15_coreMarks_mnemonics.bed.gz","E122_15_coreMarks_mnemonics.bed.gz","E123_15_coreMarks_mnemonics.bed.gz","E124_15_coreMarks_mnemonics.bed.gz","E125_15_coreMarks_mnemonics.bed.gz","E126_15_coreMarks_mnemonics.bed.gz","E127_15_coreMarks_mnemonics.bed.gz","E128_15_coreMarks_mnemonics.bed.gz","E129_15_coreMarks_mnemonics.bed.gz"])
    gzfiles=map(lambda x: "./EpigenomeBeds/"+x,["E001_15_coreMarks_mnemonics.bed.gz","E002_15_coreMarks_mnemonics.bed.gz","E003_15_coreMarks_mnemonics.bed.gz","E004_15_coreMarks_mnemonics.bed.gz","E005_15_coreMarks_mnemonics.bed.gz","E006_15_coreMarks_mnemonics.bed.gz","E007_15_coreMarks_mnemonics.bed.gz","E008_15_coreMarks_mnemonics.bed.gz","E009_15_coreMarks_mnemonics.bed.gz","E010_15_coreMarks_mnemonics.bed.gz","E011_15_coreMarks_mnemonics.bed.gz","E012_15_coreMarks_mnemonics.bed.gz","E013_15_coreMarks_mnemonics.bed.gz","E014_15_coreMarks_mnemonics.bed.gz","E015_15_coreMarks_mnemonics.bed.gz","E016_15_coreMarks_mnemonics.bed.gz","E017_15_coreMarks_mnemonics.bed.gz","E018_15_coreMarks_mnemonics.bed.gz","E019_15_coreMarks_mnemonics.bed.gz","E020_15_coreMarks_mnemonics.bed.gz","E021_15_coreMarks_mnemonics.bed.gz","E022_15_coreMarks_mnemonics.bed.gz","E023_15_coreMarks_mnemonics.bed.gz","E024_15_coreMarks_mnemonics.bed.gz","E025_15_coreMarks_mnemonics.bed.gz","E026_15_coreMarks_mnemonics.bed.gz","E027_15_coreMarks_mnemonics.bed.gz","E028_15_coreMarks_mnemonics.bed.gz","E029_15_coreMarks_mnemonics.bed.gz","E030_15_coreMarks_mnemonics.bed.gz","E031_15_coreMarks_mnemonics.bed.gz","E032_15_coreMarks_mnemonics.bed.gz","E033_15_coreMarks_mnemonics.bed.gz","E034_15_coreMarks_mnemonics.bed.gz","E035_15_coreMarks_mnemonics.bed.gz","E036_15_coreMarks_mnemonics.bed.gz","E037_15_coreMarks_mnemonics.bed.gz","E038_15_coreMarks_mnemonics.bed.gz","E039_15_coreMarks_mnemonics.bed.gz","E040_15_coreMarks_mnemonics.bed.gz","E041_15_coreMarks_mnemonics.bed.gz","E042_15_coreMarks_mnemonics.bed.gz","E043_15_coreMarks_mnemonics.bed.gz","E044_15_coreMarks_mnemonics.bed.gz","E045_15_coreMarks_mnemonics.bed.gz","E046_15_coreMarks_mnemonics.bed.gz","E047_15_coreMarks_mnemonics.bed.gz","E048_15_coreMarks_mnemonics.bed.gz","E049_15_coreMarks_mnemonics.bed.gz","E050_15_coreMarks_mnemonics.bed.gz","E051_15_coreMarks_mnemonics.bed.gz","E052_15_coreMarks_mnemonics.bed.gz","E053_15_coreMarks_mnemonics.bed.gz","E054_15_coreMarks_mnemonics.bed.gz","E055_15_coreMarks_mnemonics.bed.gz","E056_15_coreMarks_mnemonics.bed.gz","E057_15_coreMarks_mnemonics.bed.gz","E058_15_coreMarks_mnemonics.bed.gz","E059_15_coreMarks_mnemonics.bed.gz","E061_15_coreMarks_mnemonics.bed.gz","E062_15_coreMarks_mnemonics.bed.gz","E063_15_coreMarks_mnemonics.bed.gz","E065_15_coreMarks_mnemonics.bed.gz","E066_15_coreMarks_mnemonics.bed.gz","E067_15_coreMarks_mnemonics.bed.gz","E068_15_coreMarks_mnemonics.bed.gz","E069_15_coreMarks_mnemonics.bed.gz","E070_15_coreMarks_mnemonics.bed.gz","E071_15_coreMarks_mnemonics.bed.gz","E072_15_coreMarks_mnemonics.bed.gz","E073_15_coreMarks_mnemonics.bed.gz","E074_15_coreMarks_mnemonics.bed.gz","E075_15_coreMarks_mnemonics.bed.gz","E076_15_coreMarks_mnemonics.bed.gz","E077_15_coreMarks_mnemonics.bed.gz","E078_15_coreMarks_mnemonics.bed.gz","E079_15_coreMarks_mnemonics.bed.gz","E080_15_coreMarks_mnemonics.bed.gz","E081_15_coreMarks_mnemonics.bed.gz","E082_15_coreMarks_mnemonics.bed.gz","E083_15_coreMarks_mnemonics.bed.gz","E084_15_coreMarks_mnemonics.bed.gz","E085_15_coreMarks_mnemonics.bed.gz","E086_15_coreMarks_mnemonics.bed.gz","E087_15_coreMarks_mnemonics.bed.gz","E088_15_coreMarks_mnemonics.bed.gz","E089_15_coreMarks_mnemonics.bed.gz","E090_15_coreMarks_mnemonics.bed.gz","E091_15_coreMarks_mnemonics.bed.gz","E092_15_coreMarks_mnemonics.bed.gz","E093_15_coreMarks_mnemonics.bed.gz","E094_15_coreMarks_mnemonics.bed.gz","E095_15_coreMarks_mnemonics.bed.gz","E096_15_coreMarks_mnemonics.bed.gz","E097_15_coreMarks_mnemonics.bed.gz","E098_15_coreMarks_mnemonics.bed.gz","E099_15_coreMarks_mnemonics.bed.gz","E100_15_coreMarks_mnemonics.bed.gz","E101_15_coreMarks_mnemonics.bed.gz","E102_15_coreMarks_mnemonics.bed.gz","E103_15_coreMarks_mnemonics.bed.gz","E104_15_coreMarks_mnemonics.bed.gz","E105_15_coreMarks_mnemonics.bed.gz","E106_15_coreMarks_mnemonics.bed.gz","E107_15_coreMarks_mnemonics.bed.gz","E108_15_coreMarks_mnemonics.bed.gz","E109_15_coreMarks_mnemonics.bed.gz","E110_15_coreMarks_mnemonics.bed.gz","E111_15_coreMarks_mnemonics.bed.gz","E112_15_coreMarks_mnemonics.bed.gz","E113_15_coreMarks_mnemonics.bed.gz","E114_15_coreMarks_mnemonics.bed.gz","E115_15_coreMarks_mnemonics.bed.gz","E116_15_coreMarks_mnemonics.bed.gz","E117_15_coreMarks_mnemonics.bed.gz","E118_15_coreMarks_mnemonics.bed.gz","E119_15_coreMarks_mnemonics.bed.gz","E120_15_coreMarks_mnemonics.bed.gz","E121_15_coreMarks_mnemonics.bed.gz","E122_15_coreMarks_mnemonics.bed.gz","E123_15_coreMarks_mnemonics.bed.gz","E124_15_coreMarks_mnemonics.bed.gz","E125_15_coreMarks_mnemonics.bed.gz","E126_15_coreMarks_mnemonics.bed.gz","E127_15_coreMarks_mnemonics.bed.gz","E128_15_coreMarks_mnemonics.bed.gz","E129_15_coreMarks_mnemonics.bed.gz"])
    for gz in gzfiles:
        try: subprocess.check_output("gunzip "+gz,shell=True, stderr=subprocess.STDOUT)
        except: print "couldn't gunzip", gz
#         run("/Users/cmelton/Downloads/all.mnemonics.bedFiles/E055_15_coreMarks_mnemonics.bed", "/Users/cmelton/Documents/AptanaStudio3Workspace/LocalMutationData/Test/test.wig", "/Users/cmelton/Documents/AptanaStudio3Workspace/LocalMutationData/Test/test")
#         outputDir="/Users/cmelton/Downloads/all.mnemonics.bedFiles/ByChrom/"
        outputDir="./EpigenomeBeds/"
        run(gz[0:-3], outputDir+gz.split("/")[-1][0:-3]+".wig", "/Users/cmelton/Documents/AptanaStudio3Workspace/LocalMutationData/Test/test")
        try: subprocess.check_output("gzip "+gz[0:-3],shell=True, stderr=subprocess.STDOUT)
        except: print "couldn't gzip", gz